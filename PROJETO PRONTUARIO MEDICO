USE MASTER
GO
DROP DATABASE IF EXISTS PRONTUARIO
GO

CREATE DATABASE PRONTUARIO
GO

USE PRONTUARIO

CREATE TABLE PRONTUARIO..MEDICO
(
	 MEDCODIGO	INT				NOT NULL
	,MEDNOME	VARCHAR(100)	NOT NULL
	,CONSTRAINT PK_MEDICO PRIMARY KEY (MEDCODIGO)
)

CREATE TABLE PRONTUARIO.DBO.PACIENTE
(
	 PACCODIGO	INT				NOT NULL
	,PACNOME	VARCHAR(100)	NOT NULL
	,CONSTRAINT PK_PACIENTE PRIMARY KEY (PACCODIGO)
)

CREATE TABLE PRONTUARIO.DBO.MEDICAMENTO
(
	 MDCODIGO	INT				NOT NULL
	,MDNOME		VARCHAR(100)	NOT NULL
	,CONSTRAINT PK_MEDICAMENTO PRIMARY KEY (MDCODIGO)
)

CREATE TABLE PRONTUARIO.DBO.PRESCRICAO
(
	 CONCODIGO	INT				NOT NULL
	,MDCODIGO	INT				NOT NULL
	,POSOLOGIA	VARCHAR(200)	NOT NULL
)

CREATE TABLE PRONTUARIO.DBO.CONSULTA
(
	 MEDCODIGO	INT				NOT NULL
	,PACCODIGO	INT				NOT NULL
	,CONCODIGO	INT				NOT NULL
	,[DATA]		DATE			NOT NULL
)
GO

ALTER TABLE PRONTUARIO.DBO.CONSULTA
	ADD CONSTRAINT PK_CONSULTA PRIMARY KEY (CONCODIGO)

ALTER TABLE PRONTUARIO.DBO.CONSULTA
	ADD CONSTRAINT FK_MEDICO FOREIGN KEY (MEDCODIGO) REFERENCES PRONTUARIO.DBO.MEDICO (MEDCODIGO)

ALTER TABLE PRONTUARIO.DBO.CONSULTA
	ADD CONSTRAINT FK_PACIENTE FOREIGN KEY (PACCODIGO) REFERENCES PRONTUARIO.DBO.PACIENTE (PACCODIGO)

ALTER TABLE PRONTUARIO.DBO.PRESCRICAO
	ADD CONSTRAINT FK_CONSULTA FOREIGN KEY (CONCODIGO) REFERENCES PRONTUARIO.DBO.CONSULTA (CONCODIGO)

ALTER TABLE PRONTUARIO.DBO.PRESCRICAO
	ADD CONSTRAINT FK_MEDICAMENTO FOREIGN KEY (MDCODIGO) REFERENCES PRONTUARIO.DBO.MEDICAMENTO (MDCODIGO)
GO

INSERT INTO PRONTUARIO.DBO.PACIENTE		VALUES (1, 'ANDRE LIMA'), (2, 'JULINA DUARTE'), (3, 'PAULO HENRIQUE')
INSERT INTO PRONTUARIO.DBO.MEDICO		VALUES (1, 'CAROLINA ASSIS'), (2, 'JOAO DIAS')
INSERT INTO PRONTUARIO.DBO.MEDICAMENTO	VALUES (1, 'PARACETAMOL'), (2, 'DICLOFENACO DE SODIO'), (3, 'PENICILINA')
GO

INSERT INTO PRONTUARIO.DBO.CONSULTA (CONCODIGO, MEDCODIGO, PACCODIGO, [DATA])		VALUES (1, 2, 2, '2021-03-01'), (2, 1, 1, '2019-10-16'), (3, 1, 3, '2020-12-15')
GO

INSERT INTO PRONTUARIO.DBO.PRESCRICAO (CONCODIGO, MDCODIGO, POSOLOGIA)	VALUES (1, 3, '500MG 2X AO DIA'), (2, 1, '750MG A CADA 8h'), (3, 1, '1000MG A CADA 12h')
GO

-- QUESTÃO 4.a
SELECT 'PACIENTES ATENDIDOS: ' + CAST(COUNT(*) AS VARCHAR)	TOTAL FROM PRONTUARIO.DBO.CONSULTA WHERE [DATA] = '2020-12-15'

-- QUESTÃO 4.b
SELECT
	PC.PACNOME
FROM PRONTUARIO.DBO.PACIENTE		PC
INNER JOIN PRONTUARIO.DBO.CONSULTA	CN
	ON PC.PACCODIGO = CN.PACCODIGO
INNER JOIN PRONTUARIO.DBO.MEDICO	MD
	ON MD.MEDCODIGO = CN.MEDCODIGO
WHERE MD.MEDNOME = 'CAROLINA ASSIS'

-- QUESTÂO  4.c
SELECT
	 MC.MDNOME
	,PR.POSOLOGIA
FROM PRONTUARIO.DBO.PACIENTE			PC
INNER JOIN PRONTUARIO.DBO.CONSULTA		CN
	ON CN.PACCODIGO = PC.PACCODIGO
INNER JOIN PRONTUARIO.DBO.PRESCRICAO	PR
	ON PR.CONCODIGO = CN.CONCODIGO
INNER JOIN PRONTUARIO.DBO.MEDICAMENTO	MC
	ON PR.MDCODIGO = MC.MDCODIGO
WHERE PC.PACNOME = 'PAULO HENRIQUE'
